
<!DOCTYPE html>
<html lang="it">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta charset="UTF-8">
  <title>Permesso Ingresso Autisti</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
      line-height: 1.6;
    }
    input[type="text"], input[type="date"], input[type="time"] {
      border: none;
      border-bottom: 1px solid #000;
      background: transparent;
      font-size: 1em;
      padding: 2px 5px;
      width: auto;
      min-width: 100px;
    }
    .firma {
      margin-top: 40px;
    }
    button {
      margin-top: 40px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2 style="text-align: center;">PELMA SPA ‚Äì BASSANO BRESCIANO (BS)</h2>
  <p><strong>PEL 03 ‚Äì INFORMAZIONE FORMAZIONE E ADDESTRAMENTO DEL PERSONALE IN SITU</strong><br>
  ALLEGATO 4 (rev. Mag.25)<br>
  Foglio 1 di 1</p>

  <h3>PERMESSO DI ENTRATA</h3>
  <p><strong>PER OPERAZIONI DI SCARICO E/O ALTRE OPERAZIONI DI CONSEGNA O PRESA DI MATERIALE</strong></p>

  <p>Il Sig. <input type="text" placeholder="Nome e Cognome"> della ditta <input type="text" placeholder="Nome Ditta"> √® autorizzato a scaricare al reparto <strong>STOCCAGGIO</strong> i materiali: <input type="text" placeholder="Materiali"></p>

  <p>Data <input type="date"> ora entrata <input type="time"> ora uscita <input type="time"></p>

  <ul>
    <li>nello stabilimento, in conseguenza delle attivit√† che vi si svolgono, esistono rischi generici e specifici per la sicurezza: pertanto chiunque accede allo stabilimento √® tenuto ad avere, oltre alla normale prudenza, la prudenza specifica di chi √® consapevole dei pericoli esistenti;</li>
    <li>√® fatto obbligo di osservare, oltre ai regolamenti, discipline e norme antinfortunistiche vigenti nello stabilimento, le disposizioni impartite dal nostro personale;</li>
    <li>il permesso √® valido esclusivamente per lo scarico indicato e limitatamente al punto di scarico. Ogni tentativo di visitare persone o zone diverse da quelle assegnate, come pure l‚Äôinterno dello stesso stoccaggio delle materie prime, provocher√† l‚Äôimmediato allontanamento dell‚Äôautotrasportatore;</li>
    <li>la connessione del bocchettone di scarico alla cisterna viene effettuata dall‚Äôautotrasportatore su supervisione del nostro operatore;</li>
    <li>l‚Äôuscita di materiali e documenti appartenenti alla Societ√† PELMA S.p.A. deve essere appositamente autorizzata;</li>
  </ul>

  <p>Lo stabilimento √® costituito da cinque reparti: stoccaggio materie prime, produzione di poliuretano espanso, maturazione del poliuretano espanso, stoccaggio del prodotto finito e lavorazione del poliuretano espanso.</p>

  <p style="font-weight: bold; color: red;">√à FATTO ASSOLUTO DIVIETO DI ENTRARE NEI REPARTI PRODUTTIVI O NEI DEPOSITI SE NON ACCOMPAGNATI DAL PERSONALE PELMA</p>

  <h4>Norme di comportamento all‚Äôinterno dello stabilimento</h4>
  <ol>
    <li>All‚Äôinterno dello stabilimento √® assolutamente VIETATO FUMARE (anche sul proprio automezzo).</li>
    <li>√à vietato accendere fiamme libere (√® necessario farsi rilasciare il ‚Äúpermesso di fuoco‚Äù dai responsabili).</li>
    <li>Le norme di circolazione all‚Äôinterno dello stabilimento sono uguali a quelle in vigore nelle strade pubbliche; la precedenza spetta ai veicoli che provengono dalla propria destra; √® fatto obbligo a tutti i veicoli di tenere la destra; il limite di velocit√† con i mezzi all‚Äôinterno dello stabilimento √® di 15 km/h.</li>
    <li>√à obbligatorio rispettare i segnali di prescrizione presenti nello stabilimento (divieto di accesso alle persone non autorizzate, divieto di transito, etc.).</li>
    <li>I veicoli in sosta non devono creare intralcio all‚Äôattivit√† aziendale; √® vietato circolare nello stabilimento con le sponde degli automezzi abbassate; √® vietato abbandonare il mezzo all‚Äôinterno dello stabilimento, prima, durante e dopo le operazioni di scarico. Il veicolo deve circolare chiuso e con il carico in posizione di sicurezza e vincolato per evitare cadute accidentali.</li>
    <li>√à fatto divieto ai portatori di pacemaker o protesi di accedere al locale ricarica carrelli e di avvicinarsi alle operazioni di saldatura eventualmente in corso.</li>
  </ol>

  <p>In caso di emergenza e/o d‚Äôincendio contattare i preposti referenti aziendali per ricevere istruzioni e indicazioni sulle vie di fuga, sui punti di raccolta e sulle modalit√† di allontanamento o evacuazione.</p>

  <p>Sono affisse in pi√π punti dello stabilimento le norme di comportamento in caso di emergenza, con le relative planimetrie recanti i luoghi di raccolta in caso di evacuazione dello stabilimento.</p>

  <p>Il visitatore dichiara di aver ricevuto le informazioni per gli esterni relative al Piano di Emergenza Interna e preso visione del Modulo di Notifica e di Informazione di cui all‚Äôallegato 5 del D.Lgs. 105/15 nonch√© della brochure contenente le disposizioni vigenti all‚Äôinterno dello stabilimento.</p>

  
    <div class="firma">
    <p>Firma disegnata qui sotto (usa dito o mouse):</p>
    <canvas id="signature-pad" width="500" height="200" style="border:1px solid #000;"></canvas>
    <br>
    <button onclick="clearSignature()">Cancella Firma</button>
    <br><br>

    <p>Firma per accettazione di quanto sopra: <input type="text" placeholder="Firma (testuale o disegnata)"></p>
  </div>

  <button onclick="window.print()">Salva come PDF</button>



<button onclick="sendPdfCompleto('modulo_autisti')">üìß Invia PDF via Email</button>

<script>
async function htmlConFirmeInline() {
  const liveDoc = document;
  const htmlString = '<!DOCTYPE html>' + liveDoc.documentElement.outerHTML;
  const parser = new DOMParser();
  const cloneDoc = parser.parseFromString(htmlString, 'text/html');
  const qsa = (root, sel) => Array.from(root.querySelectorAll(sel));

  const liveInputs = qsa(liveDoc, 'input');
  const cloneInputs = qsa(cloneDoc, 'input');
  const minInputs = Math.min(liveInputs.length, cloneInputs.length);
  for (let i = 0; i < minInputs; i++) {
    const live = liveInputs[i];
    const c = cloneInputs[i];
    const t = (live.type || '').toLowerCase();
    if (['text','number','date','time','email','tel','hidden','search','url','password'].includes(t)) {
      c.setAttribute('value', live.value || '');
    } else if (t === 'checkbox' || t === 'radio') {
      if (live.checked) c.setAttribute('checked','checked'); else c.removeAttribute('checked');
      if (live.value != null) c.setAttribute('value', live.value);
    }
  }

  const liveTextareas = qsa(liveDoc, 'textarea');
  const cloneTextareas = qsa(cloneDoc, 'textarea');
  const minTA = Math.min(liveTextareas.length, cloneTextareas.length);
  for (let i = 0; i < minTA; i++) {
    cloneTextareas[i].textContent = liveTextareas[i].value || '';
  }

  const liveSelects = qsa(liveDoc, 'select');
  const cloneSelects = qsa(cloneDoc, 'select');
  const minSel = Math.min(liveSelects.length, cloneSelects.length);
  for (let i = 0; i < minSel; i++) {
    const val = liveSelects[i].value;
    qsa(cloneSelects[i], 'option').forEach(opt => {
      if (opt.value === val) opt.setAttribute('selected','selected');
      else opt.removeAttribute('selected');
    });
  }

  const liveCanvases = qsa(liveDoc, 'canvas');
  const cloneCanvases = qsa(cloneDoc, 'canvas');
  const len = Math.min(liveCanvases.length, cloneCanvases.length);
  for (let i = 0; i < len; i++) {
    const live = liveCanvases[i];
    const c = cloneCanvases[i];
    try {
      const data = live.toDataURL('image/png');
      const img = cloneDoc.createElement('img');
      img.alt = c.id || 'firma';
      img.width = parseInt(c.getAttribute('width') || live.width || 500, 10);
      img.height = parseInt(c.getAttribute('height') || live.height || 150, 10);
      img.src = data;
      img.style.border = c.style.border || '1px solid #000';
      c.replaceWith(img);
    } catch (e) {}
  }

  qsa(cloneDoc, 'script').forEach(s => s.remove());
  const style = cloneDoc.createElement('style');
  style.textContent = `
    @page { size: A4; margin: 12mm; }
    html, body { width: 210mm; min-height: 297mm; }
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  `;
  cloneDoc.head && cloneDoc.head.appendChild(style);

  return '<!DOCTYPE html>' + cloneDoc.documentElement.outerHTML;
}

async function sendPdfCompleto(modulo) {
  try {
    const html = await htmlConFirmeInline();
    const subject = 'Modulo ' + (modulo || 'compilato');
    const res = await fetch('/send_pdf', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ html, subject, filename: (modulo || 'modulo') + '.pdf' })
    });
    const data = await res.json();
    if (!res.ok || !data.success) throw new Error(data.error || 'Errore invio');
    alert('PDF completo inviato via email ‚úÖ');
  } catch (err) {
    alert('Errore invio PDF: ' + err.message);
    console.error(err);
  }
}
</script>


<script>
(function(){
  const CANVAS_ID = 'signature-pad';

  function getPos(canvas, evt) {
    const rect = canvas.getBoundingClientRect();
    if (evt.touches && evt.touches.length) {
      return {
        x: (evt.touches[0].clientX - rect.left),
        y: (evt.touches[0].clientY - rect.top)
      };
    } else {
      return {
        x: (evt.clientX - rect.left),
        y: (evt.clientY - rect.top)
      };
    }
  }

  function attachSignaturePad() {
    const canvas = document.getElementById(CANVAS_ID);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000';

    let drawing = false;
    let last = null;

    function start(e){
      drawing = true;
      last = getPos(canvas, e);
      e.preventDefault && e.preventDefault();
    }
    function move(e){
      if(!drawing) return;
      const pos = getPos(canvas, e);
      ctx.beginPath();
      ctx.moveTo(last.x, last.y);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      last = pos;
      e.preventDefault && e.preventDefault();
    }
    function end(e){
      drawing = false;
      last = null;
      e.preventDefault && e.preventDefault();
    }

    // Mouse
    canvas.addEventListener('mousedown', start);
    window.addEventListener('mousemove', move);
    window.addEventListener('mouseup', end);

    // Touch (non-passive to allow preventDefault)
    canvas.addEventListener('touchstart', start, {passive:false});
    canvas.addEventListener('touchmove', move, {passive:false});
    canvas.addEventListener('touchend', end, {passive:false});
    canvas.addEventListener('touchcancel', end, {passive:false});

    // Optional: disable page scroll while signing on touch
    canvas.style.touchAction = 'none';

    // Expose clear function
    window.clearSignature = function(){
      const c = document.getElementById(CANVAS_ID);
      if(!c) return;
      const ctx2 = c.getContext('2d');
      ctx2.setTransform(1,0,0,1,0,0);
      ctx2.clearRect(0,0,c.width,c.height);
      ctx2.beginPath();
    };
  }

  window.addEventListener('load', attachSignaturePad);
})();
</script>

</body>
</html>