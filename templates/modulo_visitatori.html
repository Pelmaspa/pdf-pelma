
<!DOCTYPE html>
<html lang="it">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta charset="UTF-8">
  <title>Permesso Ingresso Visitatori</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
      line-height: 1.6;
    }
    input[type="text"], input[type="date"], input[type="time"], textarea {
      border: none;
      border-bottom: 1px solid #000;
      background: transparent;
      font-size: 1em;
      padding: 2px 5px;
      min-width: 150px;
    }
    canvas {
      border: 1px solid #000;
      margin-top: 10px;
    }
    .firma-container {
      margin-top: 20px;
    }
    button {
      margin-top: 30px;
      margin-right: 10px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2 style="text-align: center;">PELMA SPA â€“ BASSANO BRESCIANO (BS)</h2>
  <p><strong>PEL 03 â€“ INFORMAZIONE FORMAZIONE E ADDESTRAMENTO DEL PERSONALE IN SITU</strong><br>
  ALLEGATO 3 (rev. Giu.18) - Foglio 1 di 1</p>

  <h3 style="text-align: center;">PERMESSO INGRESSO PER VISITATORI</h3>

  <p><strong>DATA</strong> <input type="date"> &nbsp; <strong>N.</strong> <input type="text" style="width: 50px;"></p>

  <p>Il Sig. <input type="text" placeholder="Nome visitatore"> della ditta/Ente <input type="text" placeholder="Ditta/Ente"> Ã¨ autorizzato ad entrare in stabilimento per un colloquio con il Sig. <input type="text" placeholder="Referente Pelma"></p>

  <ul>
    <li>Nello stabilimento esistono rischi generici e specifici per la sicurezza: Ã¨ richiesta prudenza.</li>
    <li>Ãˆ obbligatorio osservare le norme antinfortunistiche e le disposizioni del personale Pelma.</li>
    <li>Il permesso Ã¨ valido solo per il motivo indicato, e non per accedere ad altre persone o aree.</li>
    <li>I visitatori devono dichiarare eventuali materiali propri introdotti nello stabilimento.</li>
    <li>Lâ€™uscita di materiali/documenti Pelma deve essere autorizzata con appositi documenti.</li>
  </ul>

  <p>Lo stabilimento Ã¨ composto da: stoccaggio materie prime, produzione poliuretano, maturazione, stoccaggio prodotto finito e lavorazione poliuretano espanso.</p>

  <p style="font-weight: bold; color: red;">Ãˆ FATTO ASSOLUTO DIVIETO ENTRARE NEI REPARTI PRODUTTIVI O NEI DEPOSITI SE NON ACCOMPAGNATI DAL PERSONALE PELMA</p>

  <h4>Norme di comportamento:</h4>
  <ol>
    <li>VIETATO FUMARE.</li>
    <li>Vietato accendere fiamme libere senza autorizzazione.</li>
    <li>Circolazione interna secondo norme stradali (15 km/h, precedenze, sosta sicura).</li>
    <li>Obbligo di seguire segnali e percorsi designati (pedoni e automezzi).</li>
    <li>Divieto per portatori di pacemaker/protesi di accedere a ricarica carrelli o saldature.</li>
  </ol>

  <p>In caso di emergenza/incendio contattare i referenti aziendali per indicazioni sulle vie di fuga e raccolta. Sono affisse le planimetrie con le vie di evacuazione.</p>

  <p>Il visitatore dichiara di aver ricevuto informazioni relative al Piano di Emergenza Interna, al Modulo di Notifica (D.Lgs. 105/15) e alla brochure informativa.</p>

  <div class="firma-container">
    <p><strong>Firma per accettazione di quanto sopra:</strong></p>
    <canvas id="firma1" width="500" height="150"></canvas><br>
    <button onclick="clearCanvas('firma1')">Cancella Firma</button>
  </div>

  <p><strong>Ora entrata</strong> <input type="time"> <strong>Ora uscita</strong> <input type="time"> <strong>Firma referente colloquio:</strong></p>
  <div class="firma-container">
    <canvas id="firma2" width="500" height="150"></canvas><br>
    <button onclick="clearCanvas('firma2')">Cancella Firma</button>
  </div>

  <button onclick="window.print()">ðŸ“„ Salva come PDF</button>
  

  




<script>
async function htmlConFirmeInline() {
  const liveDoc = document;
  const htmlString = '<!DOCTYPE html>' + liveDoc.documentElement.outerHTML;
  const parser = new DOMParser();
  const cloneDoc = parser.parseFromString(htmlString, 'text/html');
  const qsa = (root, sel) => Array.from(root.querySelectorAll(sel));

  qsa(cloneDoc, 'input').forEach(c => {
    const id = c.id;
    const live = id ? liveDoc.getElementById(id) : null;
    if (!live) return;
    const t = (live.type || '').toLowerCase();
    if (['text','number','date','time','email','tel','hidden','search','url','password'].includes(t)) {
      c.setAttribute('value', live.value || '');
    } else if (t === 'checkbox' || t === 'radio') {
      if (live.checked) c.setAttribute('checked','checked'); else c.removeAttribute('checked');
      if (live.value != null) c.setAttribute('value', live.value);
    }
  });

  qsa(cloneDoc, 'textarea').forEach(c => {
    const id = c.id;
    const live = id ? liveDoc.getElementById(id) : null;
    if (!live) return;
    c.textContent = live.value || '';
  });

  qsa(cloneDoc, 'select').forEach(c => {
    const id = c.id;
    const live = id ? liveDoc.getElementById(id) : null;
    if (!live) return;
    const val = live.value;
    qsa(c, 'option').forEach(opt => {
      if (opt.value === val) opt.setAttribute('selected','selected');
      else opt.removeAttribute('selected');
    });
  });

  qsa(cloneDoc, 'canvas').forEach(c => {
    try {
      const live = c.id ? liveDoc.getElementById(c.id) : null;
      const data = live ? live.toDataURL('image/png') : null;
      const img = cloneDoc.createElement('img');
      img.alt = c.id || 'firma';
      img.width = parseInt(c.getAttribute('width') || (live ? live.width : 500), 10);
      img.height = parseInt(c.getAttribute('height') || (live ? live.height : 150), 10);
      if (data) img.src = data;
      img.style.border = c.style.border || '1px solid #000';
      c.replaceWith(img);
    } catch(e){}
  });

  qsa(cloneDoc, 'script').forEach(s => s.remove());
  const style = cloneDoc.createElement('style');
  style.textContent = `
    @page { size: A4; margin: 12mm; }
    html, body { width: 210mm; min-height: 297mm; }
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  `;
  cloneDoc.head && cloneDoc.head.appendChild(style);

  return '<!DOCTYPE html>' + cloneDoc.documentElement.outerHTML;
}

async function sendPdfCompleto(modulo) {
  try {
    const html = await htmlConFirmeInline();
    const subject = 'Modulo ' + (modulo || 'compilato');
    const res = await fetch('/send_pdf', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ html, subject, filename: (modulo || 'modulo') + '.pdf' })
    });
    const data = await res.json();
    if (!res.ok || !data.success) throw new Error(data.error || 'Errore invio');
    alert('PDF completo inviato via email âœ…');
  } catch (err) {
    alert('Errore invio PDF: ' + err.message);
    console.error(err);
  }
}
</script>


<button onclick="sendPdfCompleto('modulo_visitatori')">ðŸ“§ Invia PDF via Email</button>
</body>
</html>